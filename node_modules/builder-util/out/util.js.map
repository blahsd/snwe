{"version":3,"file":"util.js","sourceRoot":"","sources":["../src/util.ts"],"names":[],"mappings":"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","sourcesContent":["import { path7za } from \"7zip-bin\"\nimport { appBuilderPath } from \"app-builder-bin\"\nimport { safeStringifyJson } from \"builder-util-runtime\"\nimport chalk from \"chalk\"\nimport { ChildProcess, execFile, ExecFileOptions, spawn as _spawn, SpawnOptions } from \"child_process\"\nimport { createHash } from \"crypto\"\nimport _debug from \"debug\"\nimport { safeDump } from \"js-yaml\"\nimport * as path from \"path\"\nimport \"source-map-support/register\"\nimport { debug, log } from \"./log\"\n\nexport { safeStringifyJson } from \"builder-util-runtime\"\nexport { TmpDir } from \"temp-file\"\nexport { log, debug } from \"./log\"\nexport { isMacOsSierra, isCanSignDmg } from \"./macosVersion\"\nexport { execWine, prepareWindowsExecutableArgs } from \"./wine\"\nexport { Arch, getArchCliNames, toLinuxArchString, getArchSuffix, ArchType, archFromString } from \"./arch\"\nexport { AsyncTaskManager } from \"./asyncTaskManager\"\nexport { DebugLogger } from \"./DebugLogger\"\n\nexport { hashFile } from \"./hash\"\nexport { copyFile } from \"./fs\"\nexport { asArray } from \"builder-util-runtime\"\n\nexport { deepAssign } from \"./deepAssign\"\n\nexport const debug7z = _debug(\"electron-builder:7z\")\n\nexport function serializeToYaml(object: object, skipInvalid = false) {\n  return safeDump(object, {lineWidth: 8000, skipInvalid})\n}\n\nexport function removePassword(input: string) {\n  return input.replace(/(-String |-P |pass:| \\/p |-pass )([^ ]+)/g, (match, p1, p2) => {\n    if (p1.trim() === \"/p\" && p2.startsWith(\"\\\\\\\\Mac\\\\Host\\\\\\\\\")) {\n      // appx /p\n      return `${p1}${p2}`\n    }\n    return `${p1}${createHash(\"sha256\").update(p2).digest(\"hex\")} (sha256 hash)`\n  })\n}\n\nfunction getProcessEnv(env: { [key: string]: string | undefined } | undefined | null) {\n  if (process.platform === \"win32\") {\n    return env\n  }\n\n  const finalEnv = {\n    ...(env || process.env)\n  }\n\n  // without LC_CTYPE dpkg can returns encoded unicode symbols\n  // set LC_CTYPE to avoid crash https://github.com/electron-userland/electron-builder/issues/503 Even \"en_DE.UTF-8\" leads to error.\n  const locale = process.platform === \"linux\" ? (process.env.LANG || \"C.UTF-8\") : \"en_US.UTF-8\"\n  finalEnv.LANG = locale\n  finalEnv.LC_CTYPE = locale\n  finalEnv.LC_ALL = locale\n  return finalEnv\n}\n\nexport function exec(file: string, args?: Array<string> | null, options?: ExecFileOptions, isLogOutIfDebug = true): Promise<string> {\n  if (log.isDebugEnabled) {\n    const logFields: any = {\n      file,\n      args: args == null ? \"\" : removePassword(args.join(\" \")),\n    }\n    if (options != null) {\n      if (options.cwd != null) {\n        logFields.cwd = options.cwd\n      }\n\n      if (options.env != null) {\n        const diffEnv = {...options.env}\n        for (const name of Object.keys(process.env)) {\n          if (process.env[name] === options.env[name]) {\n            delete diffEnv[name]\n          }\n        }\n        logFields.env = safeStringifyJson(diffEnv)\n      }\n    }\n\n    log.debug(logFields, \"executing\")\n  }\n\n  return new Promise<string>((resolve, reject) => {\n    execFile(file, args, {\n    ...options,\n    maxBuffer: 10 * 1024 * 1024,\n    env: getProcessEnv(options == null ? null : options.env),\n  }, (error, stdout, stderr) => {\n      if (error == null) {\n        if (isLogOutIfDebug && log.isDebugEnabled) {\n          const logFields: any = {\n            file,\n          }\n          if (stdout.length > 0) {\n            logFields.stdout = stdout\n          }\n          if (stderr.length > 0) {\n            logFields.stderr = file.endsWith(\"wine\") ? removeWineSpam(stderr.toString()) : stderr\n          }\n\n          log.debug(logFields, \"executed\")\n        }\n        resolve(stdout.toString())\n      }\n      else {\n        let message = chalk.red(removePassword(`Exit code: ${(error as any).code}. ${error.message}`))\n        if (stdout.length !== 0) {\n          if (file.endsWith(\"wine\")) {\n            stdout = removeWineSpam(stdout.toString())\n          }\n          message += `\\n${chalk.yellow(stdout.toString())}`\n        }\n        if (stderr.length !== 0) {\n          if (file.endsWith(\"wine\")) {\n            stderr = removeWineSpam(stderr.toString())\n          }\n          message += `\\n${chalk.red(stderr.toString())}`\n        }\n\n        reject(new Error(message))\n      }\n    })\n  })\n}\n\nfunction removeWineSpam(out: string) {\n  return out.toString()\n    .split(\"\\n\")\n    .filter(it => !it.includes(\"wine: cannot find L\\\"C:\\\\\\\\windows\\\\\\\\system32\\\\\\\\winemenubuilder.exe\\\"\") && !it.includes(\"err:wineboot:ProcessRunKeys Error running cmd L\\\"C:\\\\\\\\windows\\\\\\\\system32\\\\\\\\winemenubuilder.exe\"))\n    .join(\"\\n\")\n\n}\n\nexport interface ExtraSpawnOptions {\n  isPipeInput?: boolean\n}\n\nfunction logSpawn(command: string, args: Array<string>, options: SpawnOptions) {\n  // use general debug.enabled to log spawn, because it doesn't produce a lot of output (the only line), but important in any case\n  if (!log.isDebugEnabled) {\n    return\n  }\n\n  const argsString = args.join(\" \")\n  const logFields: any = {\n    command: command + \" \" + (command === \"docker\" ? argsString : removePassword(argsString)),\n  }\n  if (options != null && options.cwd != null) {\n    logFields.cwd = options.cwd\n  }\n  log.debug(logFields, \"spawning\")\n}\n\nexport function doSpawn(command: string, args: Array<string>, options?: SpawnOptions, extraOptions?: ExtraSpawnOptions): ChildProcess {\n  if (options == null) {\n    options = {}\n  }\n\n  options.env = getProcessEnv(options.env)\n\n  if (options.stdio == null) {\n    const isDebugEnabled = debug.enabled\n    // do not ignore stdout/stderr if not debug, because in this case we will read into buffer and print on error\n    options.stdio = [extraOptions != null && extraOptions.isPipeInput ? \"pipe\" : \"ignore\", isDebugEnabled ? \"inherit\" : \"pipe\", isDebugEnabled ? \"inherit\" : \"pipe\"]\n  }\n\n  logSpawn(command, args, options)\n  try {\n    return _spawn(command, args, options)\n  }\n  catch (e) {\n    throw new Error(`Cannot spawn ${command}: ${e.stack || e}`)\n  }\n}\n\nexport function spawnAndWrite(command: string, args: Array<string>, data: string, options?: SpawnOptions) {\n  const childProcess = doSpawn(command, args, options, {isPipeInput: true})\n  const timeout = setTimeout(() => childProcess.kill(), 4 * 60 * 1000)\n  return new Promise<any>((resolve, reject) => {\n    handleProcess(\"close\", childProcess, command, true, () => {\n      try {\n        clearTimeout(timeout)\n      }\n      finally {\n        resolve()\n      }\n    }, error => {\n      try {\n        clearTimeout(timeout)\n      }\n      finally {\n        reject(error.stack || error.toString())\n      }\n    })\n\n    childProcess.stdin.end(data)\n  })\n}\n\nexport function spawn(command: string, args?: Array<string> | null, options?: SpawnOptions, extraOptions?: ExtraSpawnOptions): Promise<any> {\n  return new Promise<any>((resolve, reject) => {\n    const isCollectOutput = options != null && (options.stdio === \"pipe\" || (Array.isArray(options.stdio) && options.stdio.length === 3 && options.stdio[1] === \"pipe\"))\n    handleProcess(\"close\", doSpawn(command, args || [], options, extraOptions), command, isCollectOutput, resolve, reject)\n  })\n}\n\nfunction handleProcess(event: string, childProcess: ChildProcess, command: string, isCollectOutput: boolean, resolve: ((value?: any) => void) | null, reject: (reason?: any) => void) {\n  childProcess.on(\"error\", reject)\n\n  let out = \"\"\n  if (isCollectOutput && childProcess.stdout != null) {\n    childProcess.stdout.on(\"data\", (data: string) => {\n      out += data\n    })\n  }\n\n  let errorOut = \"\"\n  if (childProcess.stderr != null) {\n    childProcess.stderr.on(\"data\", (data: string) => {\n      errorOut += data\n    })\n  }\n\n  childProcess.once(event, (code: number) => {\n    if (log.isDebugEnabled) {\n      const fields: any = {\n        command: path.basename(command),\n        code,\n        pid: childProcess.pid,\n      }\n      if (out.length > 0) {\n        fields.out = out\n      }\n      log.debug(fields, \"exited\")\n    }\n\n    if (code === 0) {\n      if (resolve != null) {\n        resolve(out)\n      }\n    }\n    else {\n      function formatOut(text: string, title: string) {\n        return text.length === 0 ? \"\" : `\\n${title}:\\n${text}`\n      }\n\n      reject(new Error(`${command} exited with code ${code}${formatOut(out, \"Output\")}${formatOut(errorOut, \"Error output\")}`))\n    }\n  })\n}\n\nexport function use<T, R>(value: T | null, task: (it: T) => R): R | null {\n  return value == null ? null : task(value)\n}\n\nexport function debug7zArgs(command: \"a\" | \"x\"): Array<string> {\n  const args = [command, \"-bd\"]\n  if (debug7z.enabled) {\n    args.push(\"-bb\")\n  }\n  return args\n}\n\nexport function isEmptyOrSpaces(s: string | null | undefined): s is \"\" | null | undefined {\n  return s == null || s.trim().length === 0\n}\n\nexport function isTokenCharValid(token: string) {\n  return /^[\\w\\/=+-]+$/.test(token)\n}\n\n// fpm bug - rpm build --description is not escaped, well... decided to replace quite to smart quote\n// http://leancrew.com/all-this/2010/11/smart-quotes-in-javascript/\nexport function smarten(s: string): string {\n  // opening singles\n  s = s.replace(/(^|[-\\u2014\\s(\\[\"])'/g, \"$1\\u2018\")\n  // closing singles & apostrophes\n  s = s.replace(/'/g, \"\\u2019\")\n  // opening doubles\n  s = s.replace(/(^|[-\\u2014/\\[(\\u2018\\s])\"/g, \"$1\\u201c\")\n  // closing doubles\n  s = s.replace(/\"/g, \"\\u201d\")\n  return s\n}\n\nexport function addValue<K, T>(map: Map<K, Array<T>>, key: K, value: T) {\n  const list = map.get(key)\n  if (list == null) {\n    map.set(key, [value])\n  }\n  else if (!list.includes(value)) {\n    list.push(value)\n  }\n}\n\nexport function replaceDefault(inList: Array<string> | null | undefined, defaultList: Array<string>): Array<string> {\n  if (inList == null || (inList.length === 1 && inList[0] === \"default\")) {\n    return defaultList\n  }\n\n  const index = inList.indexOf(\"default\")\n  if (index >= 0) {\n    const list = inList.slice(0, index)\n    list.push(...defaultList)\n    if (index !== (inList.length - 1)) {\n      list.push(...inList.slice(index + 1))\n    }\n    inList = list\n  }\n  return inList\n}\n\nexport function getPlatformIconFileName(value: string | null | undefined, isMac: boolean) {\n  if (value === undefined) {\n    return undefined\n  }\n  if (value === null) {\n    return null\n  }\n\n  if (!value.includes(\".\")) {\n    return `${value}.${isMac ? \"icns\" : \"ico\"}`\n  }\n\n  return value.replace(isMac ? \".ico\" : \".icns\", isMac ? \".icns\" : \".ico\")\n}\n\nexport function isPullRequest() {\n  // TRAVIS_PULL_REQUEST is set to the pull request number if the current job is a pull request build, or false if itâ€™s not.\n  function isSet(value: string | undefined) {\n    // value can be or null, or empty string\n    return value && value !== \"false\"\n  }\n\n  return isSet(process.env.TRAVIS_PULL_REQUEST) || isSet(process.env.CI_PULL_REQUEST) || isSet(process.env.CI_PULL_REQUESTS) || isSet(process.env.BITRISE_PULL_REQUEST) || isSet(process.env.APPVEYOR_PULL_REQUEST_NUMBER)\n}\n\nexport function isEnvTrue(value: string | null | undefined) {\n  if (value != null) {\n    value = value.trim()\n  }\n  return value === \"true\" || value === \"\" || value === \"1\"\n}\n\nexport class InvalidConfigurationError extends Error {\n  constructor(message: string, code: string = \"ERR_ELECTRON_BUILDER_INVALID_CONFIGURATION\") {\n    super(message);\n\n    (this as any).code = code\n  }\n}\n\nexport function executeAppBuilder(args: Array<string>): Promise<string> {\n  return new Promise<string>((resolve, reject) => {\n    const command = appBuilderPath\n    handleProcess(\"close\", doSpawn(command, args, {\n      env: {\n        ...process.env,\n        SZA_PATH: path7za,\n      },\n      stdio: [\"ignore\", \"pipe\", \"inherit\"]\n    }), command, true, resolve, reject)\n  })\n}\n"]}
