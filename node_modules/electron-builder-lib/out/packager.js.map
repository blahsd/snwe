{"version":3,"file":"packager.js","sourceRoot":"","sources":["../src/packager.ts"],"names":[],"mappings":"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","sourcesContent":["import BluebirdPromise from \"bluebird-lst\"\nimport { deepAssign, addValue, Arch, archFromString, AsyncTaskManager, DebugLogger, exec, InvalidConfigurationError, log, safeStringifyJson, serializeToYaml, TmpDir } from \"builder-util\"\nimport { CancellationToken } from \"builder-util-runtime\"\nimport { executeFinally, orNullIfFileNotExist } from \"builder-util/out/promise\"\nimport { EventEmitter } from \"events\"\nimport { ensureDir, outputFile } from \"fs-extra-p\"\nimport isCI from \"is-ci\"\nimport { Lazy } from \"lazy-val\"\nimport * as path from \"path\"\nimport { exists } from \"builder-util/out/fs\"\nimport { AppInfo } from \"./appInfo\"\nimport { readAsarJson } from \"./asar/asar\"\nimport { AfterPackContext, Configuration } from \"./configuration\"\nimport { Platform, SourceRepositoryInfo, Target } from \"./core\"\nimport { Framework } from \"./Framework\"\nimport MacPackager from \"./macPackager\"\nimport { Metadata } from \"./options/metadata\"\nimport { createElectronFrameworkSupport } from \"./electron/ElectronFramework\"\nimport { ArtifactCreated, PackagerOptions } from \"./packagerApi\"\nimport { PlatformPackager, resolveFunction } from \"./platformPackager\"\nimport { createProtonFrameworkSupport } from \"./ProtonFramework\"\nimport { computeArchToTargetNamesMap, createTargets, NoOpTarget } from \"./targets/targetFactory\"\nimport { computeDefaultAppDirectory, getConfig, validateConfig } from \"./util/config\"\nimport { expandMacro } from \"./util/macroExpander\"\nimport { Dependency, getProductionDependencies } from \"./util/packageDependencies\"\nimport { checkMetadata, readPackageJson } from \"./util/packageMetadata\"\nimport { getRepositoryInfo } from \"./util/repositoryInfo\"\nimport { getGypEnv, installOrRebuild } from \"./util/yarn\"\nimport { WinPackager } from \"./winPackager\"\n\nfunction addHandler(emitter: EventEmitter, event: string, handler: (...args: Array<any>) => void) {\n  emitter.on(event, handler)\n}\n\ndeclare const PACKAGE_VERSION: string\n\nasync function createFrameworkInfo(configuration: Configuration, packager: Packager): Promise<Framework> {\n  if (configuration.protonNodeVersion != null) {\n    // require(\"proton-builder/out/ProtonFramework\")\n    return createProtonFrameworkSupport(configuration.protonNodeVersion!!, packager.appInfo)\n  }\n  else {\n    return await createElectronFrameworkSupport(configuration, packager)\n  }\n}\n\nexport class Packager {\n  readonly projectDir: string\n\n  private _appDir: string\n  get appDir(): string {\n    return this._appDir\n  }\n\n  private _metadata: Metadata | null = null\n  get metadata(): Metadata {\n    return this._metadata!!\n  }\n\n  private _isPrepackedAppAsar: boolean = false\n\n  get isPrepackedAppAsar(): boolean {\n    return this._isPrepackedAppAsar\n  }\n\n  private _devMetadata: Metadata | null = null\n  get devMetadata(): Metadata | null {\n    return this._devMetadata\n  }\n\n  private _configuration: Configuration | null = null\n\n  get config(): Configuration {\n    return this._configuration!!\n  }\n\n  isTwoPackageJsonProjectLayoutUsed = false\n\n  readonly eventEmitter = new EventEmitter()\n\n  _appInfo: AppInfo | null = null\n  get appInfo(): AppInfo {\n    return this._appInfo!!\n  }\n\n  readonly tempDirManager = new TmpDir(\"packager\")\n\n  private _repositoryInfo = new Lazy<SourceRepositoryInfo | null>(() => getRepositoryInfo(this.projectDir, this.metadata, this.devMetadata))\n\n  private readonly afterPackHandlers: Array<(context: AfterPackContext) => Promise<any> | null> = []\n  private readonly afterSignHandlers: Array<(context: AfterPackContext) => Promise<any> | null> = []\n\n  readonly options: PackagerOptions\n\n  readonly debugLogger = new DebugLogger(log.isDebugEnabled)\n\n  get repositoryInfo(): Promise<SourceRepositoryInfo | null> {\n    return this._repositoryInfo.value\n  }\n\n  private _productionDeps: Lazy<Array<Dependency>> | null = null\n\n  get productionDeps(): Lazy<Array<Dependency>> {\n    let result = this._productionDeps\n    if (result == null) {\n      // https://github.com/electron-userland/electron-builder/issues/2551\n      result = new Lazy(async () => {\n        if (this.config.beforeBuild == null || (await exists(path.join(this.appDir, \"node_modules\")))) {\n          return await getProductionDependencies(this.appDir)\n        }\n        else {\n          return []\n        }\n      })\n      this._productionDeps = result\n    }\n    return result\n  }\n\n  private _electronDownloader: any = null\n\n  electronDownloader: (options: any) => Promise<any> = options => {\n    if (this._electronDownloader == null) {\n      this._electronDownloader = BluebirdPromise.promisify(require(\"electron-download-tf\"))\n    }\n    return this._electronDownloader(options)\n  }\n\n  stageDirPathCustomizer: (target: Target, packager: PlatformPackager<any>, arch: Arch) => string = (target, packager, arch) => {\n    return path.join(target.outDir, `__${target.name}-${Arch[arch]}`)\n  }\n\n  private _buildResourcesDir: string | null = null\n\n  get buildResourcesDir(): string {\n    let result = this._buildResourcesDir\n    if (result == null) {\n      result = path.resolve(this.projectDir, this.relativeBuildResourcesDirname)\n      this._buildResourcesDir = result\n    }\n    return result\n  }\n\n  get relativeBuildResourcesDirname(): string {\n    return this.config.directories!!.buildResources!!\n  }\n\n  private _framework: Framework | null = null\n  get framework(): Framework {\n    return this._framework!!\n  }\n\n  //noinspection JSUnusedGlobalSymbols\n  constructor(options: PackagerOptions, readonly cancellationToken = new CancellationToken()) {\n    if (\"devMetadata\" in options) {\n      throw new InvalidConfigurationError(\"devMetadata in the options is deprecated, please use config instead\")\n    }\n    if (\"extraMetadata\" in options) {\n      throw new InvalidConfigurationError(\"extraMetadata in the options is deprecated, please use config.extraMetadata instead\")\n    }\n\n    const targets = options.targets || new Map<Platform, Map<Arch, Array<string>>>()\n    if (options.targets == null) {\n      options.targets = targets\n    }\n\n    function processTargets(platform: Platform, types: Array<string>) {\n      function commonArch(currentIfNotSpecified: boolean): Array<Arch> {\n        if (platform === Platform.MAC) {\n          return currentIfNotSpecified ? [Arch.x64] : []\n        }\n\n        const result = Array<Arch>()\n        return result.length === 0 && currentIfNotSpecified ? [archFromString(process.arch)] : result\n      }\n\n      let archToType = targets.get(platform)\n      if (archToType == null) {\n        archToType = new Map<Arch, Array<string>>()\n        targets.set(platform, archToType)\n      }\n\n      if (types.length === 0) {\n        for (const arch of commonArch(false)) {\n          archToType.set(arch, [])\n        }\n        return\n      }\n\n      for (const type of types) {\n        const suffixPos = type.lastIndexOf(\":\")\n        if (suffixPos > 0) {\n          addValue(archToType, archFromString(type.substring(suffixPos + 1)), type.substring(0, suffixPos))\n        }\n        else {\n          for (const arch of commonArch(true)) {\n            addValue(archToType, arch, type)\n          }\n        }\n      }\n    }\n\n    if (options.mac != null) {\n      processTargets(Platform.MAC, options.mac)\n    }\n    if (options.linux != null) {\n      processTargets(Platform.LINUX, options.linux)\n    }\n    if (options.win != null) {\n      processTargets(Platform.WINDOWS, options.win)\n    }\n\n    this.projectDir = options.projectDir == null ? process.cwd() : path.resolve(options.projectDir)\n    this._appDir = this.projectDir\n    this.options = {\n      ...options,\n      prepackaged: options.prepackaged == null ? null : path.resolve(this.projectDir, options.prepackaged)\n    }\n\n    try {\n      log.info({version: PACKAGE_VERSION}, \"electron-builder\")\n    }\n    catch (e) {\n      // error in dev mode without babel\n      if (!(e instanceof ReferenceError)) {\n        throw e\n      }\n    }\n  }\n\n  addAfterPackHandler(handler: (context: AfterPackContext) => Promise<any> | null) {\n    this.afterPackHandlers.push(handler)\n  }\n\n  addAfterSignHandler(handler: (context: AfterPackContext) => Promise<any> | null) {\n    this.afterSignHandlers.push(handler)\n  }\n\n  artifactCreated(handler: (event: ArtifactCreated) => void): Packager {\n    addHandler(this.eventEmitter, \"artifactCreated\", handler)\n    return this\n  }\n\n  dispatchArtifactCreated(event: ArtifactCreated) {\n    this.eventEmitter.emit(\"artifactCreated\", event)\n  }\n\n  async build(): Promise<BuildResult> {\n    let configPath: string | null = null\n    let configFromOptions = this.options.config\n    if (typeof configFromOptions === \"string\") {\n      // it is a path to config file\n      configPath = configFromOptions\n      configFromOptions = null\n    }\n    else if (configFromOptions != null && configFromOptions.extends != null && configFromOptions.extends.includes(\".\")) {\n      configPath = configFromOptions.extends\n    }\n\n    const projectDir = this.projectDir\n\n    const devPackageFile = path.join(projectDir, \"package.json\")\n    this._devMetadata = await orNullIfFileNotExist(readPackageJson(devPackageFile))\n\n    const devMetadata = this.devMetadata\n    const configuration = await getConfig(projectDir, configPath, configFromOptions, new Lazy(() => Promise.resolve(devMetadata)))\n    if (log.isDebugEnabled) {\n      log.debug({config: serializeToYaml(JSON.parse(safeStringifyJson(configuration)))}, \"effective config\")\n    }\n\n    this._appDir = await computeDefaultAppDirectory(projectDir, configuration.directories!!.app)\n    this.isTwoPackageJsonProjectLayoutUsed = this._appDir !== projectDir\n\n    const appPackageFile = this.isTwoPackageJsonProjectLayoutUsed ? path.join(this.appDir, \"package.json\") : devPackageFile\n\n    // tslint:disable:prefer-conditional-expression\n    if (this.devMetadata != null && !this.isTwoPackageJsonProjectLayoutUsed) {\n      this._metadata = this.devMetadata\n    }\n    else {\n      this._metadata = await this.readProjectMetadataIfTwoPackageStructureOrPrepacked(appPackageFile)\n    }\n    deepAssign(this.metadata, configuration.extraMetadata)\n\n    if (this.isTwoPackageJsonProjectLayoutUsed) {\n      log.debug({devPackageFile, appPackageFile}, \"two package.json structure is used\")\n    }\n    checkMetadata(this.metadata, this.devMetadata, appPackageFile, devPackageFile)\n\n    return await this._build(configuration, this._metadata, this._devMetadata)\n  }\n\n  // external caller of this method always uses isTwoPackageJsonProjectLayoutUsed=false and appDir=projectDir, no way (and need) to use another values\n  async _build(configuration: Configuration, metadata: Metadata, devMetadata: Metadata | null, repositoryInfo?: SourceRepositoryInfo): Promise<BuildResult> {\n    await validateConfig(configuration, this.debugLogger)\n    this._configuration = configuration\n    this._metadata = metadata\n    this._devMetadata = devMetadata\n\n    if (repositoryInfo != null) {\n      this._repositoryInfo.value = Promise.resolve(repositoryInfo)\n    }\n\n    this._appInfo = new AppInfo(this)\n    this._framework = await createFrameworkInfo(this.config, this)\n\n    const outDir = path.resolve(this.projectDir, expandMacro(configuration.directories!!.output!!, null, this._appInfo))\n\n    if (!isCI && (process.stdout as any).isTTY) {\n      const effectiveConfigFile = path.join(outDir, \"electron-builder-effective-config.yaml\")\n      log.info({file: log.filePath(effectiveConfigFile)}, \"writing effective config\")\n      await outputFile(effectiveConfigFile, serializeToYaml(configuration, true))\n    }\n\n    return {\n      outDir,\n      platformToTargets: await executeFinally(this.doBuild(outDir), async () => {\n        if (this.debugLogger.enabled) {\n          await this.debugLogger.save(path.join(outDir, \"electron-builder-debug.yml\"))\n        }\n        await this.tempDirManager.cleanup()\n      }),\n    }\n  }\n\n  private async readProjectMetadataIfTwoPackageStructureOrPrepacked(appPackageFile: string): Promise<Metadata> {\n    let data = await orNullIfFileNotExist(readPackageJson(appPackageFile))\n    if (data != null) {\n      return data\n    }\n\n    data = await orNullIfFileNotExist(readAsarJson(path.join(this.projectDir, \"app.asar\"), \"package.json\"))\n    if (data != null) {\n      this._isPrepackedAppAsar = true\n      return data\n    }\n\n    throw new Error(`Cannot find package.json in the ${path.dirname(appPackageFile)}`)\n  }\n\n  private async doBuild(outDir: string): Promise<Map<Platform, Map<string, Target>>> {\n    const taskManager = new AsyncTaskManager(this.cancellationToken)\n\n    const platformToTarget = new Map<Platform, Map<string, Target>>()\n    const createdOutDirs = new Set<string>()\n\n    for (const [platform, archToType] of this.options.targets!) {\n      if (this.cancellationToken.cancelled) {\n        break\n      }\n\n      if (platform === Platform.MAC && process.platform === Platform.WINDOWS.nodeName) {\n        throw new InvalidConfigurationError(\"Build for macOS is supported only on macOS, please see https://electron.build/multi-platform-build\")\n      }\n\n      const packager = this.createHelper(platform)\n      const nameToTarget: Map<string, Target> = new Map()\n      platformToTarget.set(platform, nameToTarget)\n\n      for (const [arch, targetNames] of computeArchToTargetNamesMap(archToType, packager.platformSpecificBuildOptions, platform)) {\n        if (this.cancellationToken.cancelled) {\n          break\n        }\n\n        await this.installAppDependencies(platform, arch)\n\n        if (this.cancellationToken.cancelled) {\n          break\n        }\n\n        const targetList = createTargets(nameToTarget, targetNames.length === 0 ? packager.defaultTarget : targetNames, outDir, packager)\n        await createOutDirIfNeed(targetList, createdOutDirs)\n        await packager.pack(outDir, arch, targetList, taskManager)\n      }\n\n      if (this.cancellationToken.cancelled) {\n        break\n      }\n\n      for (const target of nameToTarget.values()) {\n        taskManager.addTask(target.finishBuild())\n      }\n    }\n\n    await taskManager.awaitTasks()\n    return platformToTarget\n  }\n\n  private createHelper(platform: Platform): PlatformPackager<any> {\n    if (this.options.platformPackagerFactory != null) {\n      return this.options.platformPackagerFactory!(this, platform)\n    }\n\n    switch (platform) {\n      case Platform.MAC:\n      {\n        const helperClass: typeof MacPackager = require(\"./macPackager\").default\n        return new helperClass(this)\n      }\n\n      case Platform.WINDOWS:\n      {\n        const helperClass: typeof WinPackager = require(\"./winPackager\").WinPackager\n        return new helperClass(this)\n      }\n\n      case Platform.LINUX:\n        return new (require(\"./linuxPackager\").LinuxPackager)(this)\n\n      default:\n        throw new Error(`Unknown platform: ${platform}`)\n    }\n  }\n\n  private async installAppDependencies(platform: Platform, arch: Arch): Promise<any> {\n    if (this.options.prepackaged != null || this.framework.isNpmRebuildRequired !== true) {\n      return\n    }\n\n    const frameworkInfo = {version: this.framework.version, useCustomDist: this.config.muonVersion == null}\n    const config = this.config\n    if (config.nodeGypRebuild === true) {\n      log.info({arch: Arch[arch]}, \"executing node-gyp rebuild\")\n      await exec(process.platform === \"win32\" ? \"node-gyp.cmd\" : \"node-gyp\", [\"rebuild\"], {\n        env: getGypEnv(frameworkInfo, platform.nodeName, Arch[arch], true),\n      })\n    }\n\n    if (config.npmRebuild === false) {\n      log.info({reason: \"npmRebuild is set to false\"}, \"skipped app dependencies rebuild\")\n      return\n    }\n\n    const beforeBuild = resolveFunction(config.beforeBuild)\n    if (beforeBuild != null) {\n      const performDependenciesInstallOrRebuild = await beforeBuild({\n        appDir: this.appDir,\n        electronVersion: this.config.electronVersion!,\n        platform,\n        arch: Arch[arch]\n      })\n      if (!performDependenciesInstallOrRebuild) {\n        return\n      }\n    }\n\n    if (config.buildDependenciesFromSource === true && platform.nodeName !== process.platform) {\n      log.info({reason: \"platform is different and buildDependenciesFromSource is set to true\"}, \"skipped app dependencies rebuild\")\n    }\n    else {\n      await installOrRebuild(config, this.appDir, {\n        frameworkInfo,\n        platform: platform.nodeName,\n        arch: Arch[arch],\n        productionDeps: this.productionDeps,\n      })\n    }\n  }\n\n  afterPack(context: AfterPackContext): Promise<any> {\n    const afterPack = resolveFunction(this.config.afterPack)\n    const handlers = this.afterPackHandlers.slice()\n    if (afterPack != null) {\n      // user handler should be last\n      handlers.push(afterPack)\n    }\n    return BluebirdPromise.each(handlers, it => it(context))\n  }\n\n  afterSign(context: AfterPackContext): Promise<any> {\n    const afterSign = resolveFunction(this.config.afterSign)\n    const handlers = this.afterSignHandlers.slice()\n    if (afterSign != null) {\n      // user handler should be last\n      handlers.push(afterSign)\n    }\n    return BluebirdPromise.each(handlers, it => it(context))\n  }\n}\n\nfunction createOutDirIfNeed(targetList: Array<Target>, createdOutDirs: Set<string>): Promise<any> {\n  const ourDirs = new Set<string>()\n  for (const target of targetList) {\n    // noinspection SuspiciousInstanceOfGuard\n    if (target instanceof NoOpTarget) {\n      continue\n    }\n\n    const outDir = (target as Target).outDir\n    if (!createdOutDirs.has(outDir)) {\n      ourDirs.add(outDir)\n    }\n  }\n\n  if (ourDirs.size > 0) {\n    return BluebirdPromise.map(Array.from(ourDirs).sort(), it => {\n      createdOutDirs.add(it)\n      return ensureDir(it)\n    })\n  }\n  return Promise.resolve()\n}\n\nexport interface BuildResult {\n  readonly outDir: string\n  readonly platformToTargets: Map<Platform, Map<string, Target>>\n}\n"]}
